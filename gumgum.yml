---
  - hosts: webservers
    become: yes
    become_method: sudo
    tasks:
      - name: Update and upgrade apt packages
        become: true
        apt:
         upgrade: yes
         update_cache: yes
         cache_valid_time: 86400
      - name: install nginx server in ubuntu 14.04 LTS
        apt: name={{item}} state=present update_cache=true
        with_items:
          - python
          - python-pip
          - python-dev
          - nginx
  - hosts: webservers
    become: true
    become_method: sudo
    tasks:

      - name: create directory
        file: path=/opt/releases/{{ app_name }} state=directory
      - name: installing virtual environment
        pip:
         name: virtualenv
      - name: create virtual environment
        command: chdir=/opt/releases/{{ app_name }}
        command: virtualenv flaskappenv

  #- hosts: webservers
  #  tasks:
  #    become: true
  #    become_method: sudo
      #- name: create directory
      #  file: /opt/releases/{{ app_name }}
      #- name: clone repo
      #  git:
      #    src: https://github.com/{{ github_user}}/{{ app_name }}.git
